{% extends "layout.html" %}
{% from "button/macro.njk" import govukButton %}
{% from "error-summary/macro.njk" import govukErrorSummary %}

{% block pageTitle %}
  {% if polygonMissing %}
    Error: Confirm location - Flood map for planning - GOV.UK
  {% else %}
    Confirm location - Flood map for planning - GOV.UK
  {% endif %}
{% endblock %}

{% block content %}
  {{ super() }}
  <link rel="stylesheet" type="text/css" href="{{assetPath}}/stylesheets/ol.css">
  <link rel="stylesheet" type="text/css" href="{{assetPath}}/stylesheets/confirm-location/index.css">
  <div id="confirm-location-page" class="govuk-grid-row">

    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-xl">Draw the boundary of your site</h1>
      {% if locationDetails %} 
      <p class="govuk-body">Your search for '{{placeOrPostcodeUnencoded}}' has been placed in {{locationDetails}}</p>
      {% endif %}
      {% if polygonMissing %}
        {{ govukErrorSummary({
          titleText: "There is a problem",
          errorList: [{ text: 'Please provide a boundary', href: '#map--result' }],
          classes: "govuk-grid-column-full"
        }) 
      }}
      {% endif %}

      <p class="govuk-body">To make sure we provide you with accurate information you need to draw the boundary of your site on the map below.</p>
      
      <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            How to draw a boundary
          </span>
        </summary>
        <div class="govuk-details__text">
          <ol class="govuk-list govuk-list--number">
            <li>Select 'draw boundary'.</li>
            <li>Select any point on the site boundary.</li>
            <li>Select a second point on the boundary - you should see a line drawn between the first two points.</li>
            <li>Keep adding points until the boundary is defined.</li>
            <li>Double click or tap when you mark your final point.</li>
            <li>Edit the finished boundary by dragging the points.</li>
            <li>Add more points to a boundary by clicking or tapping on a line.</li>
          </ol>
        </div>
      </details>
    </div>

    <div class="govuk-grid-column-full map-container-column">
      <figure class="map-container confirm-location-map" role="application">
        <figcaption class="visually-hidden" aria-hidden="false">
          Use this map to confirm that the location is correct. If the location needs amending you can use the 'move marker' or 'draw boundary' map tools.
        </figcaption>
        <div id="map--result" class="map--result-confirm">
          <div class="govuk-form-group markerRadiosContainer top-of-buttons">
            <fieldset class="govuk-fieldset">
              <legend class="govuk-fieldset__legend govuk-fieldset__legend--m govuk-visually-hidden">
                Click to delete the boundary for your location
              </legend>              
              <button disabled class="govuk-button govuk-button--secondary" data-journey-click="FMFP:map:Delete" data-module="govuk-button" name="type" value="deletePolygon" id="deletePolygon">
                  Delete boundary
                </button>
            </fieldset>
          </div>
          <div id="map" class="map">
            {% include "./partials/map/no-js.html" %}
          </div>
          <div class="os-credits__text">
            <a href="os-terms" class="os-credits__link">
              OS data &copy; Crown copyright and database rights <script>
                var CurrentYear = new Date().getFullYear()
                document.write(CurrentYear)
            </script>
            </a>
          </div>
        </div>
      </figure>
    </div>

    <div class="govuk-grid-column-full">
      <div class="govuk-warning-text govuk-!-margin-top-7">
        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">Warning</span>
          Check your entire site is outlined before continuing.
        </strong>
      </div>
      <a href="/flood-zone-results?easting={{easting}}&amp;northing={{northing}}&amp;location={{location}}&amp;fullName={{fullName}}&amp;recipientemail={{recipientemail}}" role="button" draggable="false" class="govuk-button govuk-!-margin-top-2 govuk-!-margin-bottom-8 govuk-button--start" data-module="govuk-button">
        Continue
      </a>
      <h2 class="govuk-heading-m">If you need help drawing a boundary</h2>
      <p class="govuk-body">Contact the {{areaName}} at <a href="mailto:{{psoEmailAddress}}">{{psoEmailAddress}}</a></p>
      <p class="govuk-body">Or contact the Environment Agency:</p>
      <ul class="govuk-list">
        <li>
          <span>Environment Agency</span>
        </li>
        <li>
          <span>Telephone: 03708 506 506</span>
        </li>
        <li>
          <span>Monday to Friday, 8am to 6pm</span>
        </li>
        <li>
          <a href="https://www.gov.uk/call-charges">Find out about call charges</a>
        </li>
      </ul>      
    </div>
  </div>

  <script src="{{assetPath}}/javascripts/jquery.min.js"></script>
  <script src="{{assetPath}}/javascripts/confirm-location.js" data-statement=" "></script>
  <script>
      new FMP.ConfirmLocationPage({easting: '{{easting}}', northing: '{{northing}}', location: '{{location}}', fullName: '{{fullName}}', recipientemail: '{{recipientemail}}', polygon: ''})
  </script>

{% endblock %}
